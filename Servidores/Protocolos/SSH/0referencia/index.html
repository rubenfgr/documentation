<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="RubenFGR Documentaci√≥n Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="RubenFGR Documentaci√≥n Blog Atom Feed"><title data-react-helmet="true">Referencia | RubenFGR Documentaci√≥n</title><meta data-react-helmet="true" property="og:url" content="https://blogdeldesarrollador.com/documentation/Servidores/Protocolos/SSH/0referencia"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Referencia | RubenFGR Documentaci√≥n"><meta data-react-helmet="true" name="description" content="Instalaci√≥n de un servidor SSH"><meta data-react-helmet="true" property="og:description" content="Instalaci√≥n de un servidor SSH"><link data-react-helmet="true" rel="shortcut icon" href="https://raw.githubusercontent.com/rubenfgr/rubenfgr.github.io/b5205014cf5535234f31c5656431a493667a8121/assets/img/logotipo.svg"><link data-react-helmet="true" rel="canonical" href="https://blogdeldesarrollador.com/documentation/Servidores/Protocolos/SSH/0referencia"><link data-react-helmet="true" rel="alternate" href="https://blogdeldesarrollador.com/documentation/Servidores/Protocolos/SSH/0referencia" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blogdeldesarrollador.com/documentation/Servidores/Protocolos/SSH/0referencia" hreflang="x-default"><link rel="stylesheet" href="/documentation/assets/css/styles.04fe336b.css">
<link rel="preload" href="/documentation/assets/js/styles.976f3cda.js" as="script">
<link rel="preload" href="/documentation/assets/js/runtime~main.76200dab.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.e100e90f.js" as="script">
<link rel="preload" href="/documentation/assets/js/1.0df5694c.js" as="script">
<link rel="preload" href="/documentation/assets/js/2.6e418d36.js" as="script">
<link rel="preload" href="/documentation/assets/js/58.aed57805.js" as="script">
<link rel="preload" href="/documentation/assets/js/935f2afb.50fbe89a.js" as="script">
<link rel="preload" href="/documentation/assets/js/17896441.3e20e7dc.js" as="script">
<link rel="preload" href="/documentation/assets/js/f34df1c5.1ca3693d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><img src="https://raw.githubusercontent.com/rubenfgr/rubenfgr.github.io/b5205014cf5535234f31c5656431a493667a8121/assets/img/logotipo.svg" alt="RubenFGR" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://raw.githubusercontent.com/rubenfgr/rubenfgr.github.io/b5205014cf5535234f31c5656431a493667a8121/assets/img/logotipo.svg" alt="RubenFGR" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Ruben FGR - Documentaci√≥n</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/documentation/"><img src="https://raw.githubusercontent.com/rubenfgr/rubenfgr.github.io/b5205014cf5535234f31c5656431a493667a8121/assets/img/logotipo.svg" alt="RubenFGR" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://raw.githubusercontent.com/rubenfgr/rubenfgr.github.io/b5205014cf5535234f31c5656431a493667a8121/assets/img/logotipo.svg" alt="RubenFGR" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Ruben FGR - Documentaci√≥n</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/documentation/">Inicio</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Bases_de_datos</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">MySQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Bases_de_datos/MySQL/0referencia">Referencia</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">PostgreSQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Bases_de_datos/PostgreSQL/0referencia">Referencia</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CMS</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Wordpress</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/CMS/Wordpress/0referencia">Referencia</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Cloud</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">AWS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Cloud/AWS/0referencia">Referencia</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Documentaci√≥n</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Documentaci√≥n/markdown">Markdown</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Enlaces</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Enlaces/ia">IA</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Git</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Git/0referencia">Referencia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Git/consejos">Consejos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Git/enlaces">Enlaces de inter√©s</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Git/merge_vs_rebase">Merge VS Rebase</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">IDES</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/IDES/vscode">VSCode</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">IoT &amp; Maker</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ESP32</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/IoT &amp; Maker/ESP32/esp32-sim7600">ESP32 Wrover B SIM7600E</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Raspberry PI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/IoT &amp; Maker/Raspberry PI/0referencia">Referencia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/IoT &amp; Maker/Raspberry PI/docker">Docker en ARM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/IoT &amp; Maker/Raspberry PI/raspbian-vs-dietpi">Raspbian VS DietPI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/IoT &amp; Maker/Raspberry PI/temperatura-ventilador">Temperatura ventilador</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Microservicios</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Docker</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Microservicios/Docker/0referencia">Referencia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Microservicios/Docker/aliases">Aliases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Microservicios/Docker/dockerfiles">Dockerfiles</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Open_Source</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Open_Source/0referencia">Referencia</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Programaci√≥n</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">JavaScript</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Herramientas</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Webpack</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Programaci√≥n/JavaScript/Herramientas/Webpack/bootstrap-icons">Bootstrap Icons</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Programaci√≥n/JavaScript/Herramientas/Webpack/webpack">Webpack</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Programaci√≥n/JavaScript/Herramientas/eslint">ESLint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Programaci√≥n/JavaScript/Herramientas/npm">NPM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">NodeJS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Programaci√≥n/JavaScript/NodeJS/inicio-proyecto-ts">Inicio TypeScript</a></li></ul></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Servidores</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Apache</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Servidores/Apache/0referencia">Referencia</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Nginx</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Servidores/Nginx/0referencia">Referencia</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Otros</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Servidores/Otros/python-http">Python HTTP Server</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Protocolos</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">FTP</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Servidores/Protocolos/FTP/vsftpd_ubuntu20">Vsftpd Ubuntu 20.04</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">MQTT</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Servidores/Protocolos/MQTT/emqx">EMQX</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">SSH</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/documentation/Servidores/Protocolos/SSH/0referencia">Referencia</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Sistemas</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Linux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/0referencia">Referencia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/1enlaces">Enlaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/2manuales-pdf">Manuales PDF</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Herramientas</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/0enlaces">Enlaces</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/alsa">ALSA</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/alternatives">Alternatives</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/colores">Colores</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/ldap">LDAP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/nmap">Nmap</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/tar-gz-zip">Tar Gz Zip</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Linux/Herramientas/vim">VIM</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Virtualizaci√≥n</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Virtualizaci√≥n/vagrant">Vagrant</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Windows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Windows/atajos">Atajos de teclado</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Windows/eliminar-grub">Eliminar GRUB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/Windows/herramientas">Enlaces</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/disponibilidad-rendimiento">Alta disponibilidad y rendimiento</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Sistemas/ftp-comandos">Comandos FTP</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Web/apis">APIS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/Web/web-scrapping">Web Scrapping</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Referencia</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="instalaci√≥n-de-un-servidor-ssh"></a>Instalaci√≥n de un servidor SSH<a class="hash-link" href="#instalaci√≥n-de-un-servidor-ssh" title="Direct link to heading">#</a></h2><p>Habitualmente los equipos con alguna variedad de GNU/Linux traen un servidor ssh instalado, en el caso de los sistemas Debian y derivados el paquete que proporciona el servidor ssh se llama openssh-server. Podemos comprobar si ya est√° instalado mediante la instrucci√≥n:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dpkg -l |grep openssh-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ii  openssh-server            ......</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>El fichero de configuraci√≥n de este servicio se encuentra habitualmente en /etc/ssh/sshd_config y contiene las opciones de configuraci√≥n.</p><p>Las opciones aplicadas las obtendr√≠amos mediante:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">grep -v &#x27;^$\|^#&#x27; /etc/ssh/sshd_config</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ChallengeResponseAuthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">UsePAM yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">X11Forwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PrintMotd no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AcceptEnv LANG LC_*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Subsystem    sftp    /usr/lib/openssh/sftp-server</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Sin embargo, en el caso de ssh hay muchas opciones que no vienen definidas y que se asume un valor por defecto, lo que puede resultar confuso. Sin embargo podemos utilizar la opci√≥n ‚Äú-T: extended test mode‚Äù que comprueba la validez del fichero de configuraci√≥n y muestra las opciones efectivas que se aplican (las que est√°n habilitadas de forma expl√≠cita y las que tienen valores por defecto (en sistemas GNU/linux sshd s√≥lo puede ejecutarlo un usuario privilegiado):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">sshd -T</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">port 22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">addressfamily any</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">listenaddress [::]:22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">listenaddress 0.0.0.0:22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usepam yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">logingracetime 120</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">x11displayoffset 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">maxauthtries 6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">maxsessions 10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clientaliveinterval 120</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">clientalivecountmax 3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">streamlocalbindmask 0177</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permitrootlogin without-password</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ignorerhosts yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ignoreuserknownhosts no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostbasedauthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostbasedusesnamefrompacketonly no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pubkeyauthentication yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberosauthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberosorlocalpasswd yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kerberosticketcleanup yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gssapiauthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gssapikeyexchange no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gssapicleanupcredentials yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gssapistrictacceptorcheck yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gssapistorecredentialsonrekey no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">passwordauthentication yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kbdinteractiveauthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">challengeresponseauthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">printmotd no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">printlastlog yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">x11forwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">x11uselocalhost yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permittty yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permituserrc yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">strictmodes yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tcpkeepalive yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permitemptypasswords no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permituserenvironment no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">compression yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">gatewayports no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usedns no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allowtcpforwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allowagentforwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">disableforwarding no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">allowstreamlocalforwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">streamlocalbindunlink no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">useprivilegeseparation sandbox</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fingerprinthash SHA256</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pidfile /run/sshd.pid</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">xauthlocation /usr/bin/xauth</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ciphers chacha20-poly1305@openssh.com,aes128-ctr, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">macs umac-64-etm@openssh.com,umac-128-etm@openssh.com, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">versionaddendum none</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kexalgorithms curve25519-sha256,curve25519-sha256@libssh.org, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostbasedacceptedkeytypes ecdsa-sha2-nistp256-cert-v01@openssh.com, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostkeyalgorithms ecdsa-sha2-nistp256-cert-v01@openssh.com, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pubkeyacceptedkeytypes ecdsa-sha2-nistp256-cert-v01@openssh.com, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">loglevel INFO</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">syslogfacility AUTH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">authorizedkeysfile .ssh/authorized_keys .ssh/authorized_keys2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostkey /etc/ssh/ssh_host_rsa_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostkey /etc/ssh/ssh_host_ecdsa_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">hostkey /etc/ssh/ssh_host_ed25519_key</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">acceptenv LANG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">acceptenv LC_*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">authenticationmethods any</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">subsystem sftp /usr/lib/openssh/sftp-server</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">maxstartups 10:30:100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permittunnel no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ipqos lowdelay throughput</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rekeylimit 0 0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permitopen any</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="autenticaci√≥n-con-usuario-y-contrase√±a"></a>Autenticaci√≥n con usuario y contrase√±a<a class="hash-link" href="#autenticaci√≥n-con-usuario-y-contrase√±a" title="Direct link to heading">#</a></h2><p>El m√©todo inicial de autenticaci√≥n es utilizando los usuarios del sistema y las contrase√±as que tienen almacenadas en el sistema. A SSH no le afecta la forma en la que el sistema almacena las contrase√±as, entra en la forma en la que se almacenan las contrase√±as (fichero, LDAP, etc.).</p><p>Las opciones de configuraci√≥n que afectan en este caso son las siguientes:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">passwordauthentication yes|no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">challengeresponseauthentication yes|no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permitemptypasswords yes|no</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Te√≥ricamente challengeresponseauthentication es un mecanismo m√°s complejo que permite preguntar al usuario otras cuestiones, no s√≥lo la contrase√±a, pero en la pr√°ctica se suele preguntar la contrase√±a.</p><p>En sistemas GNU/Linux se a√±ade la opci√≥n</p><p><code>usepam yes</code>
Que permite utilizar el subsistema PAM como mecanismo de autenticaci√≥n.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ejercicio-simple-de-acceso-con-usuariocontrase√±a"></a>Ejercicio simple de acceso con usuario/contrase√±a<a class="hash-link" href="#ejercicio-simple-de-acceso-con-usuariocontrase√±a" title="Direct link to heading">#</a></h3><p>Accedemos a un servidor remoto con:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh usuario@172.22.200.175</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The authenticity of host &#x27;172.22.200.175 (172.22.200.175)&#x27; can&#x27;t be established.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ECDSA key fingerprint is SHA256:Bsv9OS7Qf94ANguOiDLNPHn7J+XlwisWZydmfqa4QMo.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Are you sure you want to continue connecting (yes/no)?</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Para verificar el servidor, en lugar de mostrarnos la clave p√∫blica completa, nos muestra la huella (fingerprint) de la clave p√∫blica del servidor, que no es m√°s que un hash de la clave p√∫blica, en este caso utlizando SHA256. Podemos comprobar la correspondencia entre la clave p√∫blica y la huella mediante la instrucci√≥n:</p><p>ssh-keygen -l -E sha256 -f fichero_con_clave_publica
Podr√≠amos hablar con detalle de la forma efectiva de verificar las claves p√∫blicas, pero en este momento aceptamos la clave que se nos ofrece y por tanto tecleamos ‚Äúyes‚Äù y a continuaci√≥n nos pide la contrase√±a de acceso, la introducimos y accedemos a una shell en el equipo remoto:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Warning: Permanently added &#x27;172.22.200.175&#x27; (ECDSA) to the list of known hosts.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usuario@172.22.200.175&#x27;s password: **********</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Last login: Fri Feb 16 17:34:41 2018 from 172.23.0.22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usuario@host:~$</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ejecuci√≥n-remota"></a>Ejecuci√≥n remota<a class="hash-link" href="#ejecuci√≥n-remota" title="Direct link to heading">#</a></h3><p>SSH permite ejecutar una orden remotamente de forma no interactiva, lo que resulta muy c√≥modo cuando hay que realizar tareas muy espec√≠ficas en un equipo remoto. Por ejemplo:
<code>ssh usuario@172.22.200.175 sudo apt update</code></p><p>Tambi√©n se pueden encadenar varias √≥rdenes o ejecutar un script:
<code>ssh usuario@172.22.200.175 &#x27;sudo apt update &amp;&amp; sudo apt upgrade&#x27;</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="consideraciones-acerca-de-root"></a>Consideraciones acerca de root<a class="hash-link" href="#consideraciones-acerca-de-root" title="Direct link to heading">#</a></h3><p>Se puede restringir el acceso con el usuario root utilizando contrase√±a, aspecto importante desde el punto de vista de seguridad, por lo que hoy en d√≠a habitualmente se utiliza la opcion:</p><p><code>PermitRootLogin without-password</code></p><p>En caso de que quisi√©ramos permitir acceder con el usuario root y contrase√±a, deber√≠amos poner esta opci√≥n a ‚Äúyes‚Äù.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="otras-opciones"></a>Otras opciones<a class="hash-link" href="#otras-opciones" title="Direct link to heading">#</a></h3><p>No espec√≠ficas del acceso con usuario y contrase√±a, pero adecuadas para empezar:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PrintLastLog yes|no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">PrintMotd yes|no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Banner Ruta_a_fichero</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="autenticaci√≥n-con-claves-p√∫blicaprivada-con-frase-de-paso"></a>Autenticaci√≥n con claves p√∫blica/privada con frase de paso<a class="hash-link" href="#autenticaci√≥n-con-claves-p√∫blicaprivada-con-frase-de-paso" title="Direct link to heading">#</a></h3><p>Aunque el mecanismo m√°s f√°cil de entender al utilizar ssh es la autenticaci√≥n del usuario mediante la contrase√±a en el equipo remoto, el mecanismo m√°s ‚Äúnatural‚Äù y probablemente m√°s habitual es la autenticaci√≥n mediante un par de claves p√∫blica/privada.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creaci√≥n-de-la-clave-privada"></a>Creaci√≥n de la clave privada<a class="hash-link" href="#creaci√≥n-de-la-clave-privada" title="Direct link to heading">#</a></h3><p>Para crear la clave privada utilizaremos la herramienta ssh-keygen, especificando el algoritmo que deseamos utilizar mediante el par√°metro -t (dsa | ecdsa | ed25519 | rsa | rsa1), por ejemplo:</p><p><code>ssh-keygen -t ecdsa</code></p><p>Se crear√° un di√°logo mediante el cual nos pedir√° una frase de paso para proteger la clave privada, paso que ignoraremos de momento y explicaremos con detalle en la siguiente secci√≥n:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Generating public/private ecdsa key pair.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter file in which to save the key (/home/alberto/.ssh/id_ecdsa): [ENTER]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter passphrase (empty for no passphrase): [ENTER]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter same passphrase again: [ENTER]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Your identification has been saved in /home/alberto/.ssh/id_ecdsa.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Your public key has been saved in /home/alberto/.ssh/id_ecdsa.pub.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The key fingerprint is:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SHA256:QQ0bm3FBXKhLyWUfa7teeHgufwLPdK8nIu0UlMCJ6/M alberto@mut</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The key&#x27;s randomart image is:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---[ECDSA 256]---+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|        =B==.    |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       ..BO...   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       .=* .oo   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|        *. .+    |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|       oS. ...   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|        +   o+. .|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|         o .+*+..|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|          E.=== +|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|           +o++* |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----[SHA256]-----+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>En este caso hemos optado por dejar el nombre de la clave por defecto (~/.ssh/id_ecdsa). Si vamos al directorio ~/.ssh veremos que existen dos nuevos ficheros, que se corresponden con la clave p√∫blica y la privada:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw------- 1 alberto alberto   227 feb 18 09:16 id_ecdsa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-r--r-- 1 alberto alberto   173 feb 18 09:16 id_ecdsa.pub</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>L√≥gicamente la clave privada se ha protegido en el sistema de forma que s√≥lo el propietario puede leerla o modificarla, mientras que la p√∫blica puede leerla cualquier usuario y en general podr√° estar accesible en cualquier sitio sin restricciones, ya que no es posible obtener la clave privada a partir de ella.</p><p>Vemos el contenido de estas claves (obviamente se muestran aqu√≠ a modo de ejemplo y se trata de claves que no se van a utilizar nunca en un entorno real):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">~/.ssh/id_ecdsa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----BEGIN EC PRIVATE KEY-----</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MHcCAQEEIN53r8/ghcQ94wjNPtvz0VvSFsuU7ePsPkriWPhpC137oAoGCCqGSM49</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AwEHoUQDQgAEXJKU4yRlIdnKGG8qQA2PXpfCPVz9xpbB3TXOh9ymC9XtjgP3ZCwU</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tdNnLTQNJm8PO4MHtFZBTxeFE39lD7WVYQ==</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----END EC PRIVATE KEY-----</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">~/.ssh/id_ecdsa.pub</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAy\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NTYAAABBBFySlOMkZSHZyhhvKkANj16Xwj1c/caWwd01zofcpgvV7Y4D92QsFLXT\</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Zy00DSZvDzuDB7RWQU8XhRN/ZQ+1lWE= alberto@mut</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="copia-de-la-clave-p√∫blica-en-el-equipo-remoto"></a>Copia de la clave p√∫blica en el equipo remoto<a class="hash-link" href="#copia-de-la-clave-p√∫blica-en-el-equipo-remoto" title="Direct link to heading">#</a></h3><p>Para que se pueda utilizar este mecanismo de autenticaci√≥n es preciso que la clave p√∫blica del usuario se encuentre en la cuenta que √©ste posee en el equipo remoto, de forma m√°s concreta, dentro del fichero ~/.ssh/authorized_keys, por lo que debemos utilizar alg√∫n m√©todo para ubicarla all√≠:</p><ul><li>Accedemos con contrase√±a y copiamos y pegamos la clave p√∫blica</li><li>Accedemos con otra clave p√∫blica que hubi√©semos copiado previamente y pegamos la nueva clave p√∫blica</li><li>Utilizamos cualquier sistema en el arranque de la m√°quina que obtenga la clave p√∫blica y la ubique en su sitio (muy habitual en cloud computing)</li><li>Utilizamos la herramienta ssh-copy-id
Vamos a ver el √∫ltimo m√©todo:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-copy-id -i ~/.ssh/id_ecdsa debian@172.22.200.175</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/home/alberto/.ssh/id_ecdsa.pub&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">debian@172.22.200.175&#x27;s password:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Number of key(s) added: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Now try logging into the machine, with:   &quot;ssh &#x27;debian@172.22.200.175&#x27;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">and check to make sure that only the key(s) you wanted were added.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Si accedemos al equipo remoto, podremos comprobar que la clave p√∫blica que hemos exportado se encuentra en el fichero ~/.ssh/authorized_keys.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="clave-privada-con-nombre-no-est√°ndar"></a>Clave privada con nombre no est√°ndar<a class="hash-link" href="#clave-privada-con-nombre-no-est√°ndar" title="Direct link to heading">#</a></h3><p>En el caso anterior hemos creado un par de claves con nombre est√°ndar (id_ecdsa e id_ecdsa.pub), pero es posible definir cualquier nombre a la hora de crear el par de claves, por ejemplo:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -t ed25519</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Generating public/private ed25519 key pair.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter file in which to save the key (/home/debian/.ssh/id_ed25519): openwebinars</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter passphrase (empty for no passphrase):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter same passphrase again:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Your identification has been saved in openwebinars.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Your public key has been saved in openwebinars.pub.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The key fingerprint is:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SHA256:HzEVg7wVelxLpuHrv+BUG8QG4bI0AsED7PnUvzFdlCI debian@asd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The key&#x27;s randomart image is:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+--[ED25519 256]--+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   ..oo. . .O++. |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    . o.  E*oXo. |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|   . . o. B+*o=  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|    o . .o.B +.  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|     o  S.o...o  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|      .  .+o.. o |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|          .++ .  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|          .o o   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|            . o. |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----[SHA256]-----+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Proceder√≠amos de igual forma que en el caso anterior, aunque ahora para utilizar la clave en cualquier sesi√≥n ssh, deber√≠amos indicarlo de forma expl√≠cita:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh -i ~/.ssh/openwebinars debian@172.22.200.175</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="utilizaci√≥n-en-cloud-computing"></a>Utilizaci√≥n en cloud computing<a class="hash-link" href="#utilizaci√≥n-en-cloud-computing" title="Direct link to heading">#</a></h3><p>Hoy en d√≠a es cada vez m√°s habitual la utilizaci√≥n de m√°quinas virtuales en alg√∫n proveedor de nube de infraestructura p√∫blica o privada (AWS, Azure, OpenStack, etc.), en estos casos es imprescindible utilizar este mecanismo de clave p√∫blica/privada para acceder a estas m√°quinas virtuales.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="generaci√≥n-de-una-clave-p√∫blica-a-partir-de-la-privada"></a>Generaci√≥n de una clave p√∫blica a partir de la privada<a class="hash-link" href="#generaci√≥n-de-una-clave-p√∫blica-a-partir-de-la-privada" title="Direct link to heading">#</a></h3><p>Aunque habitualmente se generan ambas claves, en diferentes circunstancias puede ocurrir que tengamos la clave privada, pero no la correspondiente clave p√∫blica, en ese caso podemos utilizar ssh-keygen para obtenerla:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -y -f clave &gt;&gt; clave.pub</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Evidentemente si tenemos la clave p√∫blica y no la privada, no podemos hacer el proceso inverso.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="utilizaci√≥n-en-procesos-no-interactivos"></a>Utilizaci√≥n en procesos no interactivos<a class="hash-link" href="#utilizaci√≥n-en-procesos-no-interactivos" title="Direct link to heading">#</a></h3><p>Puesto que teniendo acceso a la clave privada el acceso se puede realizar al equipo remoto sin ninguna intervenci√≥n, este mecanismo es ideal para su utilizaci√≥n en procesos que no requieran intervenci√≥n humana, como muchas conexiones que pueden realizarse entre diferentes equipos. La conexi√≥n es segura y autenticada, aunque es muy importante custodiar adecuadamente las claves privadas.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="autenticaci√≥n-con-claves-p√∫blicaprivada-y-frase-de-paso"></a>Autenticaci√≥n con claves p√∫blica/privada y frase de paso<a class="hash-link" href="#autenticaci√≥n-con-claves-p√∫blicaprivada-y-frase-de-paso" title="Direct link to heading">#</a></h2><p>La autenticaci√≥n con clave privada tiene importantes ventajas respecto al acceso con contrase√±a, pero tiene el inconveniente de la custodia de la clave privada. Cualquier usuario que obtuviese nuestra clave privada podr√≠a entrar en nuestra cuenta de cualquier equipo en el que tuvi√©semos exportada la correspondiente clave p√∫blica. Para aumentar la seguridad en esta situaci√≥n se utiliza una frase de paso para proteger la clave privada, frase que se introduce al crear la clave privada o que puede modificarse a posteriori. Vamos a crear una nueva clave, pero en este caso protegida con frase de paso:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -t ecdsa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Generating public/private ecdsa key pair.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter file in which to save the key (/home/alberto/.ssh/id_ecdsa):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter passphrase (empty for no passphrase): &lt;- Teclear frase de paso</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enter same passphrase again: &lt;- Teclear frase de paso</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Your identification has been saved in /home/alberto/.ssh/id_ecdsa.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Your public key has been saved in /home/alberto/.ssh/id_ecdsa.pub.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The key fingerprint is:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SHA256:mvCLrZMvdUDOorOkvd/1iosAZmhGS2fWPQmjAVMjjtk alberto@mut</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The key&#x27;s randomart image is:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---[ECDSA 256]---+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| +o+ o           |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|ooo = = .        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|o+E= = +         |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|+ = . + .        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|o* ... .S        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|=.+  o.o.        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| +.o o+..        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|. o.+= + .       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|  .o==B....      |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+----[SHA256]-----+</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>De esta forma la clave privada no es √∫til a menos que se conozca la frase de paso.</p><p>Procedemos de igual forma que en el caso anterior, exportando la clave p√∫blica, aunque ahora cada vez que accedamos nos solicitar√° la frase de paso de la clave privada:</p><p>ssh -i ~/.ssh/id_ecdsa <a href="mailto:debian@172.22.200.175" target="_blank" rel="noopener noreferrer">debian@172.22.200.175</a>
Enter passphrase for key &#x27;/home/alberto/.ssh/id_ecdsa&#x27;:
Hemos ganado en seguridad, pero hemos perdido en usabilidad, porque ahora tenemos que escribir la frase de paso cada vez que accedamos al equipo remoto y adem√°s no es v√°lido para procesos no interactivos. Para solucionar este inconveniente usaremos ssh-agent en una secci√≥n posterior.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ssh---agent"></a>SSH - Agent<a class="hash-link" href="#ssh---agent" title="Direct link to heading">#</a></h2><p>Activar SSH-Agent</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">eval &quot;$(ssh-agent -s)&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -t rsa -m PEM -f &lt;nombre-clave&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-copy-id -i ~/.ssh/id_ecdsa debian@172.22.200.175</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>ssh-agent es un programa que permite almacenar las claves privadas de una sesi√≥n y es muy √∫til cuando usamos claves con frase de paso, ya que podemos a√±adir la clave privada al agente ssh y s√≥lo tendremos que poner la frase de paso una vez, permitiendo utilizar ssh de forma transparente sin volver a introducir la frase de paso todo el tiempo que dure la sesi√≥n del usuario (realmente se puede limitar a una cantidad de tiempo menor si se desea).</p><p>ssh-agent se suele ejecutar autom√°ticamente en las sesiones gr√°ficas de los sistemas, como podemos verificar mediante:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">env |grep SSH</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SSH_AUTH_SOCK=/run/user/1001/keyring/ssh</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SSH_AGENT_PID=2743</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>O a trav√©s de ps:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ps aux |grep ssh-agent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">alberto   2743  .... ..... 0:00 /usr/bin/ssh-agent x-session-manager</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>De hecho, si tuvi√©ramos alguna clave privada sin frase de paso se habr√≠a cargado autom√°ticamente en el agente ssh y podr√≠amos utilizarla de forma totalmente transparente.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a√±adir-una-clave-privada-a-ssh-agent"></a>A√±adir una clave privada a ssh-agent<a class="hash-link" href="#a√±adir-una-clave-privada-a-ssh-agent" title="Direct link to heading">#</a></h3><p>Mediante la herramienta ssh-add podemos a√±adir una clave al agente ssh, por ejemplo:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-add ~/.ssh/openwebinars</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Si la clave est√° protegida por una frase de paso, se nos pedir√° en ese momento, o se utilizar√° la aplicaci√≥n ssh-askpass si se tratase de una aplicaci√≥n gr√°fica u otra que no tuviese asociada una terminal.</p><p>Podemos ver las claves cargadas mediante:</p><p><code>ssh-add -L</code></p><p>Y sus huellas con:</p><p><code>ssh-add -l</code></p><p>ssh-agent permite que cualquier otra aplicaci√≥n de la misma sesi√≥n utilice las claves privadas que almacena sin tener que volver a autenticarse, por lo que es importante controlar el uso de la sesi√≥n, bloque√°ndola cuando no se est√© usando.</p><p>Se pueden eliminar claves ssh del agente mediante:</p><p><code>ssh-add -d openwebinars</code></p><p>O incluso eliminar todas las claves con:</p><p><code>ssh-add -D</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ejecuci√≥n-de-ssh-agent"></a>Ejecuci√≥n de ssh-agent<a class="hash-link" href="#ejecuci√≥n-de-ssh-agent" title="Direct link to heading">#</a></h3><p>En el caso de que utilicemos un sistema que no haya cargado autom√°ticamente un agente ssh, podemos ejecutarlo directamente, habitualmente se har√≠a abriendo una nueva shell:</p><p><code>ssh-agent /bin/bash</code></p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gesti√≥n-de-ficheros-authorized_keys-y-known_hosts"></a>Gesti√≥n de ficheros: authorized_keys y known_hosts<a class="hash-link" href="#gesti√≥n-de-ficheros-authorized_keys-y-known_hosts" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fichero-sshauthorized_keys"></a>Fichero ~/.ssh/authorized_keys<a class="hash-link" href="#fichero-sshauthorized_keys" title="Direct link to heading">#</a></h3><p>Se almacenan las claves p√∫blicas de los usuarios que pueden acceder a esta cuenta mediante clave p√∫blica/clave privada, el formato es:</p><p><code>algoritmo clave_publica comentario</code></p><p>Por ejemplo:</p><p><code>ssh-rsa AAAAB3NzaC1yc2EAA...dPh alberto@mut</code></p><p>Si queremos que utilizar un par de claves para acceder a un equipo, debemos asegurarnos de que exista la clave p√∫blica en este fichero y cuando ya dejemos de utilizarla debemos borrar la l√≠nea correspondiente.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fichero-sshknown_hosts"></a>Fichero ~/.ssh/known_hosts<a class="hash-link" href="#fichero-sshknown_hosts" title="Direct link to heading">#</a></h3><p>Se almacenan las claves p√∫blicas de todos los equipos remotos a los que nos hemos conectado y que hemos aceptado, el formato es:</p><p><code>nombre_o_IP_equipo algoritmo clave_p√∫blica</code></p><p>Actualmente es m√°s habitual que no se guarde el nombre o direcci√≥n IP del equipo en claro, sino que se almacene el hash. Para encontrar un determinado equipo por nombre o direcci√≥n IP podemos utilizar la instrucci√≥n:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -F 172.22.200.175</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Host 172.22.200.175 found: line 88</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">|1|lbA....9Lo= ecdsa-sha2-nistp256 AAAA.....ynTO90=</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cambio-de-clave-p√∫blica-del-servidor"></a>Cambio de clave p√∫blica del servidor<a class="hash-link" href="#cambio-de-clave-p√∫blica-del-servidor" title="Direct link to heading">#</a></h3><p>Habitualmente se almacenan las claves p√∫blicas de los servidores a los que nos hemos conectado previamente en el fichero ~/.ssh/known_hosts, por lo que se verifica cada vez que se conecta que el servidor ofrece la misma clave p√∫blica. En caso de que no coincida veremos el siguiente mensaje:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh debian@172.22.200.175</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">It is also possible that a host key has just been changed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The fingerprint for the ECDSA key sent by the remote host is</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SHA256:J9CMWSbavkqECRI1KWhy8s/D7UVJWDiysAocAbo1F6k.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Please contact your system administrator.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add correct host key in /home/alberto/.ssh/known_hosts to get rid of this message.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Offending ECDSA key in /home/alberto/.ssh/known_hosts:88</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  remove with:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ssh-keygen -f &quot;/home/alberto/.ssh/known_hosts&quot; -R 172.22.200.175</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ECDSA host key for 172.22.200.175 has changed and you have requested strict checking.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Host key verification failed.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Es posible que se trate de una suplantaci√≥n y por tanto un problema de seguridad, pero tambi√©n es posible que se haya realizado un cambio en el servidor que haya implicado un cambio en las claves del servicio ssh o una situaci√≥n muy habitual hoy en d√≠a: estamos reutilizando la misma IP para un nuevo servidor.</p><p>En caso de que estemos seguros de que no hay ning√∫n problema de seguridad al acceder a ese equipo remoto, debemos eliminar la antigua clave asociada a la direcci√≥n IP (o al nombre), mediante la instrucci√≥n:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssh-keygen -R 172.22.200.175</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Host 172.22.200.175 found: line 88</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/home/alberto/.ssh/known_hosts updated.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Original contents retained as /home/alberto/.ssh/known_hosts.old</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="forwarding"></a>Forwarding<a class="hash-link" href="#forwarding" title="Direct link to heading">#</a></h2><p>Agent forwarding
Mediante esta t√©cnica, es posible que el cliente ssh se comunique con un agente ssh que corre un una m√°quina remota y sin necesidad de poner las claves privadas en √©l, poder saltar a otro equipo remoto no accesible directamente. Es una t√©cnica muy √∫til que permite no exponer directamente los servidores a los que realmente queremos acceder mediante ssh, sino que accedemos a ellos de forma transparente usando un equipo a modo de basti√≥n.</p><p>Esta posibilidad debe estar habilitada en el servidor intermedio mediante la directiva:</p><p><code>allowagentforwarding yes</code></p><p>Que est√° habilitada por defecto.</p><p>En el cliente es necesario habilitar el par√°metro:</p><p><code>ForwardAgent yes</code></p><p>X11 forwarding
A trav√©s de la t√©cnica de X11 forwarding podemos ver en nuestra pantalla aplicaciones gr√°ficas que se ejecutan a trav√©s de ssh en un equipo remoto (y viceversa).</p><p>Aunque en primer lugar tiene que estar permitido en el servidor a trav√©s de las directivas:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">X11Forwarding yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">X11DisplayOffset 10</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>El cliente para conectarse y utilizar esta funcionalidad, deber√° configurar adicionalmente la opci√≥n:</p><p><code>ForwardX11 yes</code></p><p>Al conectarnos por ssh podremos comprobar que est√° definida la variable DISPLAY con un valor definido a trav√©s de la variable X11DisplayOffset, por ejemplo:</p><p><code>env |grep DISPLAY</code></p><p>DISPLAY=localhost:10
Al ejecutar una aplicaci√≥n en el equipo remoto sobre la conexi√≥n ssh nos aparecer√° en nuestra pantalla.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuraci√≥n-del-cliente"></a>Configuraci√≥n del cliente<a class="hash-link" href="#configuraci√≥n-del-cliente" title="Direct link to heading">#</a></h3><p>Existe el fichero /etc/ssh/ssh_config en el que se especifican los par√°metros de configuraci√≥n generales que van a utilizar por defecto todos los clientes ssh que se ejecuten en esa m√°quina.</p><p>Los posibles par√°metros que podemos definir en ese fichero se detallan en la p√°gina 5 del manual de ssh_config.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="algunos-par√°metros-significativos"></a>Algunos par√°metros significativos<a class="hash-link" href="#algunos-par√°metros-significativos" title="Direct link to heading">#</a></h3><p>SendEnv LANG LC_*
Mediante este par√°metro se define en el equipo remoto los par√°metros de localizaci√≥n del cliente, siempre que estos est√©n definidos all√≠. Por ejemplo, supongamos que la variable local sea LANG=es.ES.UTF-8, seguir√° siendo en el equipo remoto siempre que exista, en caso contrario se pondr√° la localizaci√≥n por defecto del sistema:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">usuario@cliente:~$ echo $LANG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">es_ES.UTF-8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">usuario@cliente:~$ ssh root@servidor1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The programs included with the Debian GNU/Linux system are free software;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">the exact distribution terms for each program are described in the</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">individual files in /usr/share/doc/*/copyright.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">permitted by applicable law.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">No mail.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Last login: Thu Feb 22 10:06:47 2018 from ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">root@servidor1:~# echo $LANG</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">en_US.UTF-8</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hashknownhosts-yesno"></a>HashKnownHosts yes|no<a class="hash-link" href="#hashknownhosts-yesno" title="Direct link to heading">#</a></h3><p>Para ofuscar mediante un hash la IP o el nombre de los servidores de los que almacenamos las claves p√∫blicas en el fichero ~/.ssh/known_hosts</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gssapiauthentication-yesno"></a>GSSAPIAuthentication yes|no<a class="hash-link" href="#gssapiauthentication-yesno" title="Direct link to heading">#</a></h3><p>Para habilitar este m√©todo de autenticaci√≥n, en sistemas Debian viene habilitado, aunque s√≥lo es necesario en los casos en los que se vaya a usar este m√©todo de autenticaci√≥n.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="car√°cter-de-escape"></a>Car√°cter de escape<a class="hash-link" href="#car√°cter-de-escape" title="Direct link to heading">#</a></h3><p>En algunas ocasiones podemos tener problemas con nuestra conexi√≥n ssh y que la shell remota no responda a las instrucciones que mandamos, en esos casos siempre se podr√° cerrar la conexi√≥n mediante el car√°cter de escape que hayamos definido en nuestro cliente ssh, este caracter por defecto es ‚Äú~‚Äù:</p><p><code>EscapeChar ~</code></p><p>Para ejecutarlo escribir√≠amos la secuencia ‚Äú~.‚Äù</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="forwardagent-forwardx11"></a>ForwardAgent, ForwardX11<a class="hash-link" href="#forwardagent-forwardx11" title="Direct link to heading">#</a></h3><p>Explicados en la secci√≥n espec√≠fica de forwarding</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="globalknownhostsfile-fichero"></a>GlobalKnownHostsFile fichero<a class="hash-link" href="#globalknownhostsfile-fichero" title="Direct link to heading">#</a></h3><p>Permite la utilizaci√≥n de un fichero known_hosts para todos los
usuarios de un equipo.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="numberofpasswordprompts"></a>NumberOfPasswordPrompts<a class="hash-link" href="#numberofpasswordprompts" title="Direct link to heading">#</a></h3><p>N√∫mero de intentos de acceso con contrase√±a. Por defecto es 3</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="stricthostkeychecking-yesaskno"></a>StrictHostKeyChecking yes|ask|no<a class="hash-link" href="#stricthostkeychecking-yesaskno" title="Direct link to heading">#</a></h3><p>Par√°metro muy importante, utiliza para la gesti√≥n de las claves p√∫blicas de los equipos remotos. La opci√≥n por defecto es ‚Äúask‚Äù, de manera que si no se ha almacenado previamente la clave p√∫blica se pregunta qu√© hacer. En el caso de ponerla en ‚Äúyes‚Äù, se rechazar√° una conexi√≥n si no existe previamente la clave p√∫blica y en caso de optar por la opci√≥n ‚Äúno‚Äù, no se har√° ninguna verificaci√≥n.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="userknownhostsfile-fichero"></a>UserKnownHostsFile fichero<a class="hash-link" href="#userknownhostsfile-fichero" title="Direct link to heading">#</a></h3><p>Fichero known_hosts de usuario, por defecto ~/.ssh/known_hosts</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuraci√≥n-por-usuario"></a>Configuraci√≥n por usuario<a class="hash-link" href="#configuraci√≥n-por-usuario" title="Direct link to heading">#</a></h3><p>Salvo algunos par√°metros generales, es poco probable que la mayor√≠a de los par√°metros que se pueden definir para el cliente ssh sean √∫tiles para todos los usuarios de un equipo, es mucho m√°s habitual que un usuario defina un fichero de configuraci√≥n con sus propios par√°metros. Este fichero es ~/.ssh/config y los par√°metros aqu√≠ definidos prevalecen sobre los generales.</p><p>Se pueden definir par√°metros para todos los equipos remotos, pero es tambi√©n muy √∫til agruparlos con el par√°metro Host como en el siguiente ejemplo:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">GSSAPIAuthentication no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Host 192.168.1.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     User root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Port 2022</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     ForwardAgent yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     Identityfile ~/.ssh/id_ecdsa</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     StrictHostKeyChecking yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Host *.example.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     StrictHostKeyChecking no</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     UserKnownHostsFile=/dev/null</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     LogLevel QUIET</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="utilizar-par√°metros-directamente"></a>Utilizar par√°metros directamente<a class="hash-link" href="#utilizar-par√°metros-directamente" title="Direct link to heading">#</a></h3><p>Independientemente de los par√°metros que est√©n definidos en cualquiera de las opciones anteriores, tambi√©n es posible utilizar par√°metros de forma expl√≠cita en la propia l√≠nea de comandos, pas√°ndolos mediante el modificador ‚Äú-o‚Äù, por ejemplo:</p><p><code>ssh -o &quot;ForwardAgent yes&quot; usuario@172.22.200.175</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configuraci√≥n-del-servidor"></a>Configuraci√≥n del servidor<a class="hash-link" href="#configuraci√≥n-del-servidor" title="Direct link to heading">#</a></h2><p>Tal como vimos en la instalaci√≥n y configuraci√≥n elemental del servidor ssh, podemos ver las opciones de configuraci√≥n que se aplican a nuestro servidor mediante:</p><p><code>sshd -T |less</code></p><p>Vamos a comentar algunas que pueden ser interesantes porque se modifican con cierta frecuencia.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="port-22"></a>Port 22<a class="hash-link" href="#port-22" title="Direct link to heading">#</a></h3><p>Puerto tcp en el qu va a escuchar peticiones el servidor ssh, por defecto es el 22/tcp, pero puede cambiarse sin problema.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="addressfamily-anyinetinet6"></a>AddressFamily any|inet|inet6<a class="hash-link" href="#addressfamily-anyinetinet6" title="Direct link to heading">#</a></h3><p>El protocolo o protocolos de red a utilizar, puede ser inet(IPv4), inet6 (IPv6) o any(ambos) que es la opci√≥n por defecto.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="listenaddress"></a>ListenAddress<a class="hash-link" href="#listenaddress" title="Direct link to heading">#</a></h3><p>Si queremos especificar que se permitan conexiones s√≥lo a trav√©s de una direcci√≥n IP concreta (IPv4/IPv6).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="logingracetime-maxauthtries-y-maxsessions"></a>logingracetime, maxauthtries y maxsessions<a class="hash-link" href="#logingracetime-maxauthtries-y-maxsessions" title="Direct link to heading">#</a></h3><p>Para especificar el tiempo que se espera para que el usuario se acceda con √©xito al sistema, el n√∫mero m√°ximo de veces que puede introducir la contrase√±a y el n√∫mero m√°ximo de sesiones en la misma conexi√≥n.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="loglevel-y-syslogfacility"></a>loglevel y syslogfacility<a class="hash-link" href="#loglevel-y-syslogfacility" title="Direct link to heading">#</a></h3><p>Para controlar el nivel de detalle que mostrar en los logs del sistema, as√≠ como la ‚Äúfacility‚Äù a utilizar.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hostkey"></a>hostkey<a class="hash-link" href="#hostkey" title="Direct link to heading">#</a></h3><p>Fichero o ficheros que especifican la clave o claves privadas a utilizar por el servidor.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="utilizaci√≥n-de-scp"></a>Utilizaci√≥n de SCP<a class="hash-link" href="#utilizaci√≥n-de-scp" title="Direct link to heading">#</a></h2><p>El cliente ssh incluye tambi√©n el comando ‚Äúscp‚Äù que permite copiar ficheros entre entre equipos mediante ssh y hacerlo de forma equivalente a la utilizaci√≥n local del cl√°sico comando ‚Äúcp‚Äù.</p><p>No es necesario que el equipo origen o destino sea el equipo desde el que se ejecuta scp, tanto origen como destino pueden ser equipos a los que pueda acceder el usuario utilizando ssh.</p><p>La sintaxis general de scp es:</p><p><code>scp [[user@]host1:]file1 [[user@]host2:]file2</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transferir-un-fichero-local-a-un-equipo-remoto"></a>Transferir un fichero local a un equipo remoto<a class="hash-link" href="#transferir-un-fichero-local-a-un-equipo-remoto" title="Direct link to heading">#</a></h3><p><code>scp /etc/resolv.conf usuario@172.22.200.175:resolv.conf.local</code></p><p>El fichero remoto quedar√° como /home/usuario/resolv.conf.local ya que : indica el punto de acceso al equipo (/home/usuario/ en este caso)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transferir-un-fichero-desde-un-equipo-remoto-a-mi-equipo-local"></a>Transferir un fichero desde un equipo remoto a mi equipo local<a class="hash-link" href="#transferir-un-fichero-desde-un-equipo-remoto-a-mi-equipo-local" title="Direct link to heading">#</a></h3><p><code>scp root@172.22.200.175:/etc/shadow .</code></p><p>Que guardar√≠a el fichero /etc/shadow del equipo remoto con el nombre shadow en el directorio en el que nos encontramos</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transferir-un-fichero-entre-dos-equipos-remotos"></a>Transferir un fichero entre dos equipos remotos<a class="hash-link" href="#transferir-un-fichero-entre-dos-equipos-remotos" title="Direct link to heading">#</a></h3><p><code>scp root@172.22.200.175:/etc/hosts root@172.22.200.176:/etc/hosts</code></p><p>Esta opci√≥n es muy potente y permite crear sencillos scripts para unificar configuraciones, por ejemplo imaginemos que queremos tener la misma configuraci√≥n DNS en un conjunto de servidores, podr√≠amos hacerlo de forma sencilla y potente con ssh mediante el siguiente script:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for i in `seq 1 100`; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  scp root@servidor1:/etc/resolv.conf 192.168.1.$i:/etc/resolv.conf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">done</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="bonus-track"></a>Bonus track<a class="hash-link" href="#bonus-track" title="Direct link to heading">#</a></h3><p>Si utilizamos pares de claves en las conexiones, scp autocompleta el fichero origen o destino utilizando el doble tabulador</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sftp"></a>SFTP<a class="hash-link" href="#sftp" title="Direct link to heading">#</a></h2><p>Al igual que scp, sftp permite transferir ficheros entre equipos remotos a trav√©s de SSH, aunque su principal diferencia es que sftp permite utilizarlo de una forma interactiva, al igual que el tradicional ftp, incluyendo los mismos comandos que √©ste. scp es mucho m√°s habitual utilizarlo desde l√≠nea de comandos, mientras que sftp se puede utilizar bien desde la l√≠nea de comandos o a trav√©s de uno de los m√∫ltiples clientes ftp que lo soportan.</p><p>Es importante no confundir sftp (ssh ftp) con ftps que es una extensi√≥n del protocolo ftp a√±adiendo ssl para el cifrado de la conexi√≥n.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="t√∫neles-ssh"></a>T√∫neles SSH<a class="hash-link" href="#t√∫neles-ssh" title="Direct link to heading">#</a></h2><p>Esta t√©cnica, tambi√©n conocida como TCP forwarding o port forwarding, permite utilizar cualquier aplicaci√≥n de forma segura a trav√©s de una conexi√≥n ssh (de ah√≠ la utilizaci√≥n del t√©rmino t√∫nel).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="local-forwarding"></a>Local forwarding<a class="hash-link" href="#local-forwarding" title="Direct link to heading">#</a></h3><p>Desde nuestra m√°quina queremos acceder a un servicio, pero este servicio o bien no es accesible (por ejemplo por un cortafuegos que lo impide), o no es seguro hacerlo desde nuestra m√°quina, pero tenemos acceso a otro equipo a trav√©s de ssh y desde ese equipo s√≠ podemos acceder al servicio que queremos o es seguro hacerlo. Vamos a verlo con un ejemplo: queremos enviar un correo desde nuestro servidor de la empresa (puerto 25/tcp), pero estamos fuera y no queremos conectarnos de forma insegura, por lo que establecemos un t√∫nel ssh de la siguiente forma:</p><p><code>ssh -f -L 1025:smtp.example.com:25 remoto.example.com -N</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Cerrar el proceso del tunel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kill &lt;id-proceso&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Esto abrir√° el puerto 1025/tcp en nuestra m√°quina que podremos utilizar de forma segura para enviar correo, ya que se pasar√° a trav√©s de ssh al equipo remoto.example.com y de ah√≠ al servidor smtp.example.com.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="remote-forwarding"></a>Remote forwarding<a class="hash-link" href="#remote-forwarding" title="Direct link to heading">#</a></h3><p>Supongamos el caso contrario, en el que queremos que una m√°quina remota utilice un servicio de nuestra m√°quina, pero o bien no es accesible de forma directa o bien no es seguro hacerlo, por lo que podr√≠amos definir una conexi√≥n ssh para realizarlo como la siguiente:</p><p><code>ssh -f -L 8080:localhost:80 remoto.example.com -N</code></p><p>De esa manera desde el equipo remoto, quien acceda al puerto 8080/tcp estar√° accesiendo al puerto 80/tcp de nuestra m√°quina a trav√©s de un t√∫nel ssh.</p><p>La directiva ‚ÄúGatewayPorts yes|no‚Äù limita el puerto 8080 del caso anterior a que se pueda acceder s√≥lo desde el propio equipo remoto, o bien desde cualquier equipo.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="forwarding-din√°mico"></a>Forwarding din√°mico<a class="hash-link" href="#forwarding-din√°mico" title="Direct link to heading">#</a></h3><p>Mediante este mecanismo, lo que hacemos es crear un servidor SOCKS en nuestro equipo, que permite utilizar desde nuestra m√°quina cualquier cliente que soporte este mecanismo, en particular un navegador web. Definir√≠amos un servidor socks local que sale a trav√©s de un t√∫nel ssh con un equipo remoto de la siguiente forma:</p><p><code>ssh -D 8080 -f -C -q -N remote.example.com</code></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/Servidores/Protocolos/SSH/0referencia.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documentation/Servidores/Protocolos/MQTT/emqx"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ EMQX</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documentation/Sistemas/Linux/0referencia"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Referencia ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#instalaci√≥n-de-un-servidor-ssh" class="table-of-contents__link">Instalaci√≥n de un servidor SSH</a></li><li><a href="#autenticaci√≥n-con-usuario-y-contrase√±a" class="table-of-contents__link">Autenticaci√≥n con usuario y contrase√±a</a><ul><li><a href="#ejercicio-simple-de-acceso-con-usuariocontrase√±a" class="table-of-contents__link">Ejercicio simple de acceso con usuario/contrase√±a</a></li><li><a href="#ejecuci√≥n-remota" class="table-of-contents__link">Ejecuci√≥n remota</a></li><li><a href="#consideraciones-acerca-de-root" class="table-of-contents__link">Consideraciones acerca de root</a></li><li><a href="#otras-opciones" class="table-of-contents__link">Otras opciones</a></li><li><a href="#autenticaci√≥n-con-claves-p√∫blicaprivada-con-frase-de-paso" class="table-of-contents__link">Autenticaci√≥n con claves p√∫blica/privada con frase de paso</a></li><li><a href="#creaci√≥n-de-la-clave-privada" class="table-of-contents__link">Creaci√≥n de la clave privada</a></li><li><a href="#copia-de-la-clave-p√∫blica-en-el-equipo-remoto" class="table-of-contents__link">Copia de la clave p√∫blica en el equipo remoto</a></li><li><a href="#clave-privada-con-nombre-no-est√°ndar" class="table-of-contents__link">Clave privada con nombre no est√°ndar</a></li><li><a href="#utilizaci√≥n-en-cloud-computing" class="table-of-contents__link">Utilizaci√≥n en cloud computing</a></li><li><a href="#generaci√≥n-de-una-clave-p√∫blica-a-partir-de-la-privada" class="table-of-contents__link">Generaci√≥n de una clave p√∫blica a partir de la privada</a></li><li><a href="#utilizaci√≥n-en-procesos-no-interactivos" class="table-of-contents__link">Utilizaci√≥n en procesos no interactivos</a></li></ul></li><li><a href="#autenticaci√≥n-con-claves-p√∫blicaprivada-y-frase-de-paso" class="table-of-contents__link">Autenticaci√≥n con claves p√∫blica/privada y frase de paso</a></li><li><a href="#ssh---agent" class="table-of-contents__link">SSH - Agent</a><ul><li><a href="#a√±adir-una-clave-privada-a-ssh-agent" class="table-of-contents__link">A√±adir una clave privada a ssh-agent</a></li><li><a href="#ejecuci√≥n-de-ssh-agent" class="table-of-contents__link">Ejecuci√≥n de ssh-agent</a></li></ul></li><li><a href="#gesti√≥n-de-ficheros-authorized_keys-y-known_hosts" class="table-of-contents__link">Gesti√≥n de ficheros: authorized_keys y known_hosts</a><ul><li><a href="#fichero-sshauthorized_keys" class="table-of-contents__link">Fichero ~/.ssh/authorized_keys</a></li><li><a href="#fichero-sshknown_hosts" class="table-of-contents__link">Fichero ~/.ssh/known_hosts</a></li><li><a href="#cambio-de-clave-p√∫blica-del-servidor" class="table-of-contents__link">Cambio de clave p√∫blica del servidor</a></li></ul></li><li><a href="#forwarding" class="table-of-contents__link">Forwarding</a><ul><li><a href="#configuraci√≥n-del-cliente" class="table-of-contents__link">Configuraci√≥n del cliente</a></li><li><a href="#algunos-par√°metros-significativos" class="table-of-contents__link">Algunos par√°metros significativos</a></li><li><a href="#hashknownhosts-yesno" class="table-of-contents__link">HashKnownHosts yes|no</a></li><li><a href="#gssapiauthentication-yesno" class="table-of-contents__link">GSSAPIAuthentication yes|no</a></li><li><a href="#car√°cter-de-escape" class="table-of-contents__link">Car√°cter de escape</a></li><li><a href="#forwardagent-forwardx11" class="table-of-contents__link">ForwardAgent, ForwardX11</a></li><li><a href="#globalknownhostsfile-fichero" class="table-of-contents__link">GlobalKnownHostsFile fichero</a></li><li><a href="#numberofpasswordprompts" class="table-of-contents__link">NumberOfPasswordPrompts</a></li><li><a href="#stricthostkeychecking-yesaskno" class="table-of-contents__link">StrictHostKeyChecking yes|ask|no</a></li><li><a href="#userknownhostsfile-fichero" class="table-of-contents__link">UserKnownHostsFile fichero</a></li><li><a href="#configuraci√≥n-por-usuario" class="table-of-contents__link">Configuraci√≥n por usuario</a></li><li><a href="#utilizar-par√°metros-directamente" class="table-of-contents__link">Utilizar par√°metros directamente</a></li></ul></li><li><a href="#configuraci√≥n-del-servidor" class="table-of-contents__link">Configuraci√≥n del servidor</a><ul><li><a href="#port-22" class="table-of-contents__link">Port 22</a></li><li><a href="#addressfamily-anyinetinet6" class="table-of-contents__link">AddressFamily any|inet|inet6</a></li><li><a href="#listenaddress" class="table-of-contents__link">ListenAddress</a></li><li><a href="#logingracetime-maxauthtries-y-maxsessions" class="table-of-contents__link">logingracetime, maxauthtries y maxsessions</a></li><li><a href="#loglevel-y-syslogfacility" class="table-of-contents__link">loglevel y syslogfacility</a></li><li><a href="#hostkey" class="table-of-contents__link">hostkey</a></li></ul></li><li><a href="#utilizaci√≥n-de-scp" class="table-of-contents__link">Utilizaci√≥n de SCP</a><ul><li><a href="#transferir-un-fichero-local-a-un-equipo-remoto" class="table-of-contents__link">Transferir un fichero local a un equipo remoto</a></li><li><a href="#transferir-un-fichero-desde-un-equipo-remoto-a-mi-equipo-local" class="table-of-contents__link">Transferir un fichero desde un equipo remoto a mi equipo local</a></li><li><a href="#transferir-un-fichero-entre-dos-equipos-remotos" class="table-of-contents__link">Transferir un fichero entre dos equipos remotos</a></li><li><a href="#bonus-track" class="table-of-contents__link">Bonus track</a></li></ul></li><li><a href="#sftp" class="table-of-contents__link">SFTP</a></li><li><a href="#t√∫neles-ssh" class="table-of-contents__link">T√∫neles SSH</a><ul><li><a href="#local-forwarding" class="table-of-contents__link">Local forwarding</a></li><li><a href="#remote-forwarding" class="table-of-contents__link">Remote forwarding</a></li><li><a href="#forwarding-din√°mico" class="table-of-contents__link">Forwarding din√°mico</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">
        Copyright ¬© 2021, Rub√©n Francisco Gazquez Rosales<br>
        Documentaci√≥n para el desarrollo de aplicaciones multiplataforma y web, sistemas e iot<br>
        Construido con Docusaurus v2
      </div></div></div></footer></div>
<script src="/documentation/assets/js/styles.976f3cda.js"></script>
<script src="/documentation/assets/js/runtime~main.76200dab.js"></script>
<script src="/documentation/assets/js/main.e100e90f.js"></script>
<script src="/documentation/assets/js/1.0df5694c.js"></script>
<script src="/documentation/assets/js/2.6e418d36.js"></script>
<script src="/documentation/assets/js/58.aed57805.js"></script>
<script src="/documentation/assets/js/935f2afb.50fbe89a.js"></script>
<script src="/documentation/assets/js/17896441.3e20e7dc.js"></script>
<script src="/documentation/assets/js/f34df1c5.1ca3693d.js"></script>
</body>
</html>